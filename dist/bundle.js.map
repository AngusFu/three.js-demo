{"version":3,"file":"bundle.js","sources":["../index.js","../node_modules/raf/index.js","../node_modules/performance-now/lib/performance-now.js","../config.js"],"sourcesContent":["import raf from 'raf';\nimport now from 'performance-now';\nimport { screenOneFlags } from './config';\nconst THREE = window.THREE;\n\nconst SEPARATION = 70;\nconst AMOUNTX = 50;\nconst AMOUNTY = 60;\nwindow.x = (x) => mouseX = x;\nwindow.y = (x) => mouseY = x;\nlet count = 0;\nlet mouseX = 85;\nlet mouseY = -420;\nlet windowHalfX = window.innerWidth / 2;\nlet windowHalfY = window.innerHeight / 2;\n\nconst screenOneFlagStyles = screenOneFlags.map(f => {\n  const { cn, en, mins, maxs } = f;\n  const div = document.createElement('div');\n  div.className = 'flag-1';\n  div.innerHTML = `<p>${en}</p><h2>${cn}</h2>`;\n  document.body.appendChild(div);\n  return {\n    style: div.style,\n    mins,\n    maxs\n  };\n});\nconst screenOneFlagMap = screenOneFlags.reduce((acc, f, i) => {\n  acc[f.cord] = screenOneFlagStyles[i]\n  return acc;\n}, {});\n\nconst scene = new THREE.Scene();\nconst renderer = new THREE.CanvasRenderer();\nconst camera = new THREE.PerspectiveCamera(120, window.innerWidth / window.innerHeight, 1, 10000);\ncamera.position.z = 800;\n\nconst {\n  particles,\n  pointsWithFlag\n} = initParticles(); \nparticles.forEach(p => scene.add(p));\n\n/**\n * Axis helper\n */\n// const axisHelper = new THREE.AxisHelper(1000000);\n// axisHelper.position.set(0, 0, 0);\n// scene.add(axisHelper);\n\ninit();\n\nfunction init() {\n  const container = document.createElement('div');\n  renderer.setPixelRatio(window.devicePixelRatio);\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  container.appendChild(renderer.domElement);\n  document.body.appendChild(container);\n  animate();\n\n  window.addEventListener('resize', function onWindowResize() {\n    windowHalfX = window.innerWidth / 2;\n    windowHalfY = window.innerHeight / 2;\n    camera.aspect = window.innerWidth / window.innerHeight;\n    camera.updateProjectionMatrix();\n    renderer.setSize(window.innerWidth, window.innerHeight);\n  }, false);\n}\n\nfunction animate() {\n  raf(animate);\n  render();\n}\n\nfunction render() {\n  camera.position.x += (mouseX - camera.position.x) * .05;\n  camera.position.y += (-mouseY - camera.position.y) * .05;\n  camera.lookAt(scene.position);\n\n  let i = 0;\n  let j = 0;\n  for (let ix = 0; ix < AMOUNTX; ix++) {\n    for (let iy = 0; iy < AMOUNTY; iy++) {\n      const particle = particles[i++];\n      particle.position.y = (Math.sin((ix + count) * 0.3) * 50) + (Math.sin((iy + count) * 0.5) * 50);\n      particle.scale.x\n        = particle.scale.y\n        = (Math.sin((ix + count) * 0.3) + 1) * 1.4 + (Math.sin((iy + count) * 0.5) + 1) * 1.4;\n\n      if (screenOneFlagMap[`${ix}x${iy}`]) {\n        const point = pointsWithFlag[j++];\n        point.y = particle.position.y;\n\n        const { style, mins, maxs } = screenOneFlagMap[`${ix}x${iy}`];\n        const { x, y } = toScreenCords(point, camera);\n        const scale = Math.min(\n          Math.max(\n            particle.scale.x / 6 * maxs,\n            mins\n          ),\n          maxs\n        ) + particle.scale.x / 30;\n        style.transform = `translate3d(${x}px, ${y}px, 0) scale(${scale})`;\n      }\n    }\n  }\n\n  renderer.render(scene, camera);\n  count += 0.1;\n}\n\n/**\n * 绘制并添加波纹粒子\n */\nfunction initParticles() {\n  let index = 0;\n  const particles = [];\n  const pointsWithFlag = [];\n  const material = new THREE.SpriteCanvasMaterial({\n    color: 0x94fffb,\n    program: function (context) {\n      context.beginPath();\n      context.arc(0, 0, 1, 0, Math.PI * 2, true);\n      context.fill();\n    }\n  });\n\n  for (let i = 0; i < AMOUNTX; i++) {\n    for (let j = 0; j < AMOUNTY; j++) {\n      const particle = new THREE.Sprite(material);\n      particle.position.x = i * SEPARATION - ((AMOUNTX * SEPARATION) / 2);\n      particle.position.z = j * SEPARATION - ((AMOUNTY * SEPARATION) / 2);\n\n      particles[index++] = particle;\n      // scene.add(particle);\n\n      if (`${i}x${j}` in screenOneFlagMap) {\n        const { x, z } = particle.position;\n        pointsWithFlag.push({ x, z });\n      }\n    }\n  }\n  return {\n    particles,\n    pointsWithFlag\n  };\n}\n\n/**\n * 将 Three.js 中点的位置投射为屏幕位置\n */\nfunction toScreenCords({\n  x,\n  y,\n  z\n}, camera) {\n  const vector = (new THREE.Vector3(x, y, z)).project(camera);\n  return {\n    x: Math.round(windowHalfX * (1 + vector.x)),\n    y: Math.round(windowHalfY * (1 - vector.y))\n  };\n}\n\nfunction makeDigits() {\n  const canvas = document.createElement('canvas');\n  canvas.width = 20;\n  canvas.height = 300;\n  const ctx = canvas.getContext('2d');\n\n  const fontSize = 12;\n  const column = Math.floor(canvas.width / fontSize) / 2;\n  let www = 0;\n\n  raf(draw);\n\n  //输出文字\n  let last = now();\n  function draw(t) {\n    if (now() - last > 100) {\n      last = t;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.05)\";\n      ctx.fillRect(0,0,canvas.width,canvas.height);\n      ctx.fillStyle = \"#01c7bf\";\n      ctx.font = fontSize + \"px arial\";\n      ctx.fillText(\n        Math.random() > .4 ? 1 : 0,\n        5,\n        www * fontSize + 10\n      );\n\n      www = www * fontSize > canvas.height ? 0 : www;\n      www += 2;\n    }\n    raf(draw);\n  }\n\n  document.body.appendChild(canvas);\n  canvas.style.cssText = `\n    position: absolute;\n    z-index: 9;\n    left: 30px;\n    top: 60px;\n  `;\n}\nmakeDigits();\n","var now = require('performance-now')\n  , root = typeof window === 'undefined' ? global : window\n  , vendors = ['moz', 'webkit']\n  , suffix = 'AnimationFrame'\n  , raf = root['request' + suffix]\n  , caf = root['cancel' + suffix] || root['cancelRequest' + suffix]\n\nfor(var i = 0; !raf && i < vendors.length; i++) {\n  raf = root[vendors[i] + 'Request' + suffix]\n  caf = root[vendors[i] + 'Cancel' + suffix]\n      || root[vendors[i] + 'CancelRequest' + suffix]\n}\n\n// Some versions of FF have rAF but not cAF\nif(!raf || !caf) {\n  var last = 0\n    , id = 0\n    , queue = []\n    , frameDuration = 1000 / 60\n\n  raf = function(callback) {\n    if(queue.length === 0) {\n      var _now = now()\n        , next = Math.max(0, frameDuration - (_now - last))\n      last = next + _now\n      setTimeout(function() {\n        var cp = queue.slice(0)\n        // Clear queue here to prevent\n        // callbacks from appending listeners\n        // to the current frame's queue\n        queue.length = 0\n        for(var i = 0; i < cp.length; i++) {\n          if(!cp[i].cancelled) {\n            try{\n              cp[i].callback(last)\n            } catch(e) {\n              setTimeout(function() { throw e }, 0)\n            }\n          }\n        }\n      }, Math.round(next))\n    }\n    queue.push({\n      handle: ++id,\n      callback: callback,\n      cancelled: false\n    })\n    return id\n  }\n\n  caf = function(handle) {\n    for(var i = 0; i < queue.length; i++) {\n      if(queue[i].handle === handle) {\n        queue[i].cancelled = true\n      }\n    }\n  }\n}\n\nmodule.exports = function(fn) {\n  // Wrap in a new function to prevent\n  // `cancel` potentially being assigned\n  // to the native rAF function\n  return raf.call(root, fn)\n}\nmodule.exports.cancel = function() {\n  caf.apply(root, arguments)\n}\nmodule.exports.polyfill = function() {\n  root.requestAnimationFrame = raf\n  root.cancelAnimationFrame = caf\n}\n","// Generated by CoffeeScript 1.12.2\n(function() {\n  var getNanoSeconds, hrtime, loadTime, moduleLoadTime, nodeLoadTime, upTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - nodeLoadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    moduleLoadTime = getNanoSeconds();\n    upTime = process.uptime() * 1e9;\n    nodeLoadTime = moduleLoadTime - upTime;\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n\n//# sourceMappingURL=performance-now.js.map\n","export const screenOneFlags = [{\n  en: \"Technology driven retail\",\n  cn: \"技术驱动零售\",\n  cord: \"10x30\",\n  maxs: 0.6,\n  mins: 0.2\n}, {\n  en: \"New retail\",\n  cn: \"新零售\",\n  cord: \"24x40\",\n  maxs: 1.5,\n  mins: 1\n}, {\n  en: \"Digital marketing\",\n  cn: \"数字营销\",\n  cord: \"28x32\",\n  maxs: 0.6,\n  mins: 0.2\n}, {\n  en: \"Reconstruction of freight yard\",\n  cn: \"人货场重构\",\n  cord: \"38x24\",\n  maxs: 0.5,\n  mins: 0.15\n}, {\n  en: \"Data brand\",\n  cn: \"数据赋能品牌\",\n  cord: \"33x38\",\n  maxs: 1.2,\n  mins: 0.9\n}];\n"],"names":["animate","raf","render","camera","position","x","mouseX","y","mouseY","lookAt","scene","let","i","j","ix","AMOUNTX","iy","AMOUNTY","const","particle","particles","Math","sin","count","scale","screenOneFlagMap","point","pointsWithFlag","style","mins","maxs","toScreenCords","min","max","transform","renderer","ref","z","vector","THREE","Vector3","project","round","windowHalfX","windowHalfY","getNanoSeconds","hrtime","loadTime","moduleLoadTime","nodeLoadTime","upTime","performance","now","module","process","hr","uptime","Date","getTime","call","this","root","window","global","vendors","suffix","caf","length","last","id","queue","callback","_now","next","setTimeout","cp","slice","cancelled","e","push","handle","fn","apply","arguments","requestAnimationFrame","cancelAnimationFrame","screenOneFlags","en","cn","cord","SEPARATION","innerWidth","innerHeight","screenOneFlagStyles","map","f","div","document","createElement","className","innerHTML","body","appendChild","reduce","acc","Scene","CanvasRenderer","PerspectiveCamera","index","material","SpriteCanvasMaterial","color","program","context","beginPath","arc","PI","fill","Sprite","forEach","p","add","container","setPixelRatio","devicePixelRatio","setSize","domElement","addEventListener","aspect","updateProjectionMatrix","draw","t","ctx","fillStyle","fillRect","canvas","width","height","font","fontSize","fillText","random","www","getContext","floor","cssText"],"mappings":"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"}